<!doctype html>
<html lang="fa" dir="rtl" data-bs-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="قالب اختصاصی MrClock">
  <meta name="theme-color" content="#000000">
  <title>ناحیه کاربری</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">
  
  <style>
    :root {
      --bs-body-font-family: "Vazirmatn", sans-serif;
      --bs-body-bg: #000000;
      --my-gray: #151515;
      --my-dark-gray: #1c1c1c;
      --my-alpha-gray: rgba(255, 255, 255, .15);
      --my-heading: rgb(225, 225, 225);
      --my-content: rgba(255, 255, 255, .55);
      --my-blue: #6aa6ff;
    }

    .btn {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .my-btn-hiddify-outline {
      --bs-btn-color: var(--my-blue);
      --bs-btn-border-color: var(--my-blue);
      --bs-btn-hover-color: #fff;
      --bs-btn-hover-bg: var(--my-blue);
    }
    
    .my-btn-singbox-outline {
      --bs-btn-color: #fff;
      --bs-btn-border-color: #fff;
      --bs-btn-hover-color: #000;
      --bs-btn-hover-bg: #fff;
    }

    .my-btn-outline {
      --bs-btn-color: var(--my-heading);
      --bs-btn-border-color: var(--my-alpha-gray);
      --bs-btn-hover-color: var(--my-heading);
      --bs-btn-hover-bg: var(--my-gray);
      --bs-border-radius: 10px;
      width: 100%;
      padding: 0.5rem 1rem !important;
    }

    .bi {
      fill: currentColor;
      width: 1em;
      height: 1em;
    }

    .my-container {
      max-width: 1024px;
      padding: 75px 25px;
    }

    .my-block {
      border-radius: var(--bs-border-radius-xl);
      background-color: var(--my-gray);
      padding: 1rem;
    }
    
    .my-block-big {
      border-radius: var(--bs-border-radius-xl);
      background-color: var(--my-gray);
      padding: 1.5rem 1.5rem 1rem;
    }

    .my-text-heading { color: var(--my-heading); }
    .my-text-content { color: var(--my-content); }

    .my-step-counter {
      display: block;
      color: #fff;
      font-weight: 500;
      font-size: 2.5rem;
      user-select: none;
    }

    .my-step-counter::after {
      content: counter(step-counter);
      counter-increment: step-counter;
    }

    .my-tab-pane {
      counter-reset: step-counter;
    }

    .download-buttons, .connection-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .download-buttons .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border-radius: 10px;
      padding: 0.5rem 1rem !important;
    }

    .modal.my-modal {
      --bs-modal-bg: var(--my-gray);
      --bs-modal-border-radius: var(--bs-border-radius-xl);
      --bs-modal-header-padding: 1.5rem 1.5rem 0;
      --bs-modal-header-border-width: 0;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: bold;
      color: var(--my-heading);
      margin: 1.5rem 0 1rem;
    }

    .config-link {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      margin-bottom: 0.75rem;
      background-color: var(--my-dark-gray);
      border-radius: 10px;
    }

    .config-link-name {
      font-weight: 500;
      color: var(--my-heading);
      flex-grow: 1;
    }

    .config-link-copy-btn {
      min-width: 80px;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      background-color: var(--bs-body-bg);
      color: white;
      border: none;
      transition: background-color 0.2s;
    }

    .config-link-copy-btn:hover,
    .config-link-copy-btn.copied {
      background-color: var(--my-gray);
    }

    .traffic-value {
      font-family: "Vazirmatn", sans-serif;
      direction: ltr;
      display: inline-block;
      text-align: left;
      width: 100%;
    }

    @media (min-width: 576px) {
      .connection-buttons {
        flex-direction: row;
      }
      .connection-buttons .btn {
        flex: 1;
      }
    }
  </style>
</head>
<body>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
    <symbol id="android" viewBox="0 0 24 24"><path d="M17.6 9.48l1.84-3.18c.16-.31.04-.69-.26-.85-.29-.15-.65-.06-.83.22l-1.88 3.24c-2.86-1.21-6.08-1.21-8.94 0L5.65 5.67c-.19-.29-.58-.38-.87-.2-.28.18-.37.54-.22.83L6.4 9.48C3.3 11.25 1.28 14.44 1 18h22c-.28-3.56-2.3-6.75-5.4-8.52zM7 15.25c-.69 0-1.25-.56-1.25-1.25S6.31 12.75 7 12.75s1.25.56 1.25 1.25S7.69 15.25 7 15.25zm10 0c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25z"/></symbol>
    <symbol id="microsoft" viewBox="0 0 16 16"><path d="M7.462 0H0v7.19h7.462V0zM16 0H8.538v7.19H16V0zM7.462 8.211H0V16h7.462V8.211zm8.538 0H8.538V16H16V8.211z"/></symbol>
    <symbol id="apple" viewBox="0 0 16 16"><path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516s1.52.087 2.475-1.258.762-2.391.728-2.43m3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422s1.675-2.789 1.698-2.854-.597-.79-1.254-1.157a3.7 3.7 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56s.625 1.924 1.273 2.796c.576.984 1.34 1.667 1.659 1.899s1.219.386 1.843.067c.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758q.52-1.185.473-1.282"/></symbol>
    <symbol id="plus-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/></symbol>
    <symbol id="person-circle" viewBox="0 0 16 16"><path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/><path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/></symbol>
    <symbol id="clock" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"/><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"/></symbol>
    <symbol id="arrow-down-circle" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293z"/></symbol>
    <symbol id="check-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/></symbol>
    <symbol id="x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></symbol>
    <symbol id="telegram" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69.03-.1.06-.2-.06-.3s-.34-.04-.49-.03c-.21.03-3.53 2.23-4.92 3.3-.42.33-.8.49-1.14.48-.38-.01-1.08-.21-1.6-.38-.65-.22-1.17-.34-1.13-.73.03-.32.85-.62 1.68-.95z"/></symbol>
    <symbol id="list-ul" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/></symbol>
  </svg>

  <div class="container my-container" x-data>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="my-text-heading fw-bold mb-0">وضعیت اشتراک</h4>
    </div>
    
    <div class="row row-cols-2 row-cols-md-4 g-3 mb-4">
      <div class="col">
        <div class="my-block" x-data="blockName">
          <div class="d-flex flex-row flex-sm-column align-items-center align-items-sm-start mb-1 mb-sm-0">
            <svg class="bi me-2 mb-0 mb-sm-2"><use href="#person-circle"></use></svg>
            <h5 class="my-text-heading mb-0">نام</h5>
          </div>
          <p class="text-truncate my-text-content mb-0" x-text="getText"></p>
        </div>
      </div>
      <div class="col">
        <div class="my-block" x-data="blockStatus">
          <div class="d-flex flex-row flex-sm-column align-items-center align-items-sm-start mb-1 mb-sm-0">
            <svg class="bi me-2 mb-0 mb-sm-2"><use :href="getIcon"></use></svg>
            <h5 class="my-text-heading mb-0">وضعیت</h5>
          </div>
          <p class="text-truncate my-text-content mb-0" x-text="getText"></p>
        </div>
      </div>
      <div class="col">
        <div class="my-block" x-data="blockDuration">
          <div class="d-flex flex-row flex-sm-column align-items-center align-items-sm-start mb-1 mb-sm-0">
            <svg class="bi me-2 mb-0 mb-sm-2"><use href="#clock"></use></svg>
            <h5 class="my-text-heading mb-0">مدت زمان</h5>
          </div>
          <p class="text-truncate my-text-content mb-0" x-text="getText"></p>
        </div>
      </div>
      <div class="col">
        <div class="my-block" x-data="blockTraffic">
          <div class="d-flex flex-row flex-sm-column align-items-center align-items-sm-start mb-1 mb-sm-0">
            <svg class="bi me-2 mb-0 mb-sm-2"><use href="#arrow-down-circle"></use></svg>
            <h5 class="my-text-heading mb-0">ترافیک</h5>
          </div>
          <p class="text-truncate my-text-content mb-0" x-html="getText"></p>
        </div>
      </div>
    </div>
    
    <div class="connection-buttons">
      <a class="btn my-btn-outline" href="https://t.me/آیدی پشتیبانی" role="button" rel="noopener noreferrer" target="_blank">
        <svg class="bi me-1"><use href="#telegram"></use></svg>
        پشتیبانی
      </a>
      <button class="btn my-btn-outline" data-bs-toggle="modal" data-bs-target="#get-link-modal">
        <svg class="bi me-1"><use href="#list-ul"></use></svg>
        نمایش کانفیگ‌ها
      </button>
    </div>
    
    <h4 class="my-text-heading fw-bold section-title">راهنمای اتصال</h4>

    <div class="modal my-modal fade" id="get-link-modal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="my-text-heading fw-semibold mb-0">لینک‌ کانفیگ ها</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" x-data="configLinks">
            <div class="mb-3">
              <div class="config-link">
                <div class="config-link-name">لینک اشتراک</div>
                <button class="config-link-copy-btn" @click="copyLink(subscriptionUrl, $el)">کپی</button>
              </div>
              
              <template x-for="(link, index) in links" :key="index">
                <div class="config-link">
                  <div class="config-link-name" x-text="getLinkName(link)"></div>
                  <button class="config-link-copy-btn" @click="copyLink(link, $el)">کپی</button>
                </div>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="tab-content">
      <div id="tab-pc" class="tab-pane my-tab-pane fade show active">
        <div class="row row-cols-1 row-cols-lg-3 g-3">
          <div class="col">
            <div class="my-block-big h-100">
              <span class="my-step-counter mb-1"></span>
              <h5 class="my-text-heading fw-semibold">دانلود برنامه‌ها</h5>
              <p class="my-text-content">با توجه به سیستم عامل خود برنامه مورد نظر را دانلود کنید</p>
              <div class="download-buttons">
                <a class="btn my-btn-hiddify-outline" href="https://github.com/hiddify/hiddify-next/releases/latest/download/Hiddify-Windows-Setup-x64.exe" role="button" rel="noopener noreferrer" target="_blank">
                  <svg class="bi" width="16" height="16"><use href="#microsoft"></use></svg>
                  هیدیفای ویندوز
                </a>
                <a class="btn my-btn-hiddify-outline" href="https://github.com/hiddify/hiddify-next/releases/latest/download/Hiddify-Android-universal.apk" role="button" rel="noopener noreferrer" target="_blank">
                  <svg class="bi" width="16" height="16"><use href="#android"></use></svg>
                  هیدیفای اندروید
                </a>
                <a class="btn my-btn-hiddify-outline" href="https://apps.apple.com/us/app/hiddify-proxy-vpn/id6596777532" role="button" rel="noopener noreferrer" target="_blank">
                  <svg class="bi" width="16" height="16"><use href="#apple"></use></svg>
                  هیدیفای اپل
                </a>
                <a class="btn my-btn-singbox-outline" href="https://github.com/SagerNet/sing-box/releases/download/v1.11.5/SFA-1.11.5-universal.apk" role="button" rel="noopener noreferrer" target="_blank">
                  <svg class="bi" width="16" height="16"><use href="#android"></use></svg>
                  سینگ‌ باکس اندروید
                </a>
                <a class="btn my-btn-singbox-outline" href="https://apps.apple.com/us/app/sing-box-vt/id6673731168" role="button" rel="noopener noreferrer" target="_blank">
                  <svg class="bi" width="16" height="16"><use href="#apple"></use></svg>
                  سینگ‌ باکس اپل
                </a>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="my-block-big h-100" x-data="importActions">
              <span class="my-step-counter mb-1"></span>
              <h5 class="my-text-heading fw-semibold">افزودن اشتراک</h5>
              <p class="my-text-content">برای وارد کردن تنظیمات از دکمه‌های زیر استفاده کنید</p>
              <div class="download-buttons">
                <a class="btn my-btn-hiddify-outline" href="#" @click.prevent="importHiddify" role="button">
                  <svg class="bi" width="16" height="16"><use href="#plus-circle"></use></svg>
                  وارد کردن تنظیمات هیدیفای
                </a>
                <a class="btn my-btn-singbox-outline" href="#" @click.prevent="importSingbox" role="button">
                  <svg class="bi" width="16" height="16"><use href="#plus-circle"></use></svg>
                  وارد کردن تنظیمات سینگ باکس
                </a>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="my-block-big h-100">
              <span class="my-step-counter mb-1"></span>
              <h5 class="my-text-heading fw-semibold">اتصال و استفاده</h5>
              <p class="my-text-content mb-2">در برنامه هیدیفای روی دکمه CONNECT و در سینگ باکس روی ENABLE بزنید</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script>
    document.addEventListener('alpine:init', () => {
      const formatBytes = (bytes) => {
        if (!bytes || bytes.toString().startsWith('{')) return '0';
        bytes = parseInt(bytes);
        if (bytes === 0) return '0 B';
        
        const units = ['B', 'KB', 'MB', 'GB', 'TB'];
        let i = 0;
        
        while (bytes >= 1024 && i < units.length - 1) {
          bytes /= 1024;
          i++;
        }
        
        return `${bytes.toFixed(2)} ${units[i]}`;
      };

      Alpine.data('configLinks', () => ({
        subscriptionUrl: '{{ user.subscription_url }}',
        links: [{% for link in user.links %}'{{ link }}'{% if not loop.last %}, {% endif %}{% endfor %}],
        
        getLinkName(link) {
          if (link === this.subscriptionUrl) return 'لینک اشتراک';
          
          const protocolMap = {
            'vmess://': () => {
              try { 
                const config = JSON.parse(atob(link.replace('vmess://', '')));
                return config.ps || 'کانفیگ VMESS';
              } catch { 
                return 'کانفیگ VMESS'; 
              }
            },
            'vless://': () => {
              try {
                const url = new URL(link);
                const params = new URLSearchParams(url.hash.slice(1));
                return params.get('remark') || decodeURIComponent(url.hash.slice(1)) || 'کانفیگ VLESS';
              } catch {
                return 'کانفیگ VLESS';
              }
            },
            'trojan://': () => {
              try {
                const url = new URL(link);
                const params = new URLSearchParams(url.hash.slice(1));
                return params.get('remark') || 'کانفیگ Trojan';
              } catch {
                return 'کانفیگ Trojan';
              }
            },
            'ss://': () => {
              try {
                const decoded = atob(link.replace('ss://', '').split('@')[0]);
                const parts = decoded.split(':');
                return parts.length > 1 ? decodeURIComponent(parts[1]) || 'کانفیگ Shadowsocks' : 'کانفیگ Shadowsocks';
              } catch {
                return 'کانفیگ Shadowsocks';
              }
            }
          };
          
          for (const [prefix, handler] of Object.entries(protocolMap)) {
            if (link.startsWith(prefix)) {
              return handler();
            }
          }
          
          try {
            const url = new URL(link);
            const params = new URLSearchParams(url.hash.slice(1));
            return params.get('remark') || decodeURIComponent(url.hash.slice(1)) || 'لینک کانفیگ';
          } catch {
            return link.includes('#') ? decodeURIComponent(link.split('#')[1]) || 'لینک کانفیگ' : 'لینک کانفیگ';
          }
        },
        
        copyLink(link, button) {
          navigator.clipboard.writeText(link);
          button.textContent = 'کپی شد';
          button.classList.add('copied');
          setTimeout(() => {
            button.textContent = 'کپی';
            button.classList.remove('copied');
          }, 2000);
        }
      }));

      Alpine.data('importActions', () => ({
        importHiddify() {
          window.location.href = `hiddify://import/${'{{ user.subscription_url }}'}`;
        },
        importSingbox() {
          window.location.href = `sing-box://import-remote-profile?url=${'{{ user.subscription_url }}'}#{{ user.username }}`;
        }
      }));

      Alpine.data('blockName', () => ({
        username: '{{ user.username }}',
        getText() {
          return this.username.startsWith('{') ? 'ناشناس' : this.username;
        }
      }));

      Alpine.data('blockStatus', () => ({
        statusValue: '{{ user.status.value }}',
        getIcon() {
          return this.statusValue == 'active' || this.statusValue.startsWith('{') 
            ? '#check-circle' : '#x-circle';
        },
        getText() {
          const statusMap = {
            'active': 'فعال',
            'limited': 'محدود',
            'expired': 'منقضی‌شده',
            'disabled': 'غیرفعال'
          };
          return this.statusValue.startsWith('{') ? 'ناشناس' : (statusMap[this.statusValue] || 'ناشناس');
        }
      }));

      Alpine.data('blockDuration', () => ({
        expire: '{% if user.expire %}{{ user.expire | datetime }}{% endif %}',
        getText() {
          if (!this.expire) return 'نامحدود';
          if (this.expire.startsWith('{')) return 'ناشناس';
          return `تا ${new Date(this.expire).toLocaleDateString('fa-IR')}`;
        }
      }));

      Alpine.data('blockTraffic', () => ({
        usedTraffic: {{ user.used_traffic }},
        dataLimit: {{ user.data_limit if user.data_limit else 'null' }},
        
        getText() {
          if (this.dataLimit === null || this.dataLimit === 'null') {
            return `<span class="traffic-value">${formatBytes(this.usedTraffic)} / ∞</span>`;
          }
          
          if (this.dataLimit.toString().startsWith('{')) {
            return 'ناشناس';
          }
          
          return `
            <span class="traffic-value">
              ${formatBytes(this.usedTraffic)} / ${formatBytes(this.dataLimit)}
            </span>
          `;
        }
      }));
    });
  </script>
</body>
</html>
